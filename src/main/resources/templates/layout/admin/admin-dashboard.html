<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.4.4/dist/css/tempus-dominus.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css" />

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.4.4/dist/js/tempus-dominus.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css" />



   
    <style>
        body {
            background-color: #e9ecef;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
        }

        .sidebar {
            background-color: #343a40;
            color: white;
            height: 100vh;
            padding-top: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, .1);
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
        }

        .sidebar a {
            color: #adb5bd;
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 5px;
            margin: 5px 10px;
        }

        .sidebar a i {
            margin-right: 10px;
            font-size: 1.1em;
        }

        .sidebar a:hover {
            background-color: #495057;
            color: white;
        }

        .content {
            padding: 30px;
            margin-left: 25%;
            width: 75%;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                height: auto;
                width: 100%;
                box-shadow: none;
                padding-bottom: 0;
            }

            .content {
                margin-left: 0;
                width: 100%;
            }
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, .05);
        }

        .card-header {
            background-color: #007bff;
            color: white;
            border-bottom: none;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
        }

        .card-header h3 {
            margin-bottom: 0;
            color: white;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 sidebar">
                <h4 class="text-center mb-4 text-white">Admin Panel</h4>
                <a href="#" class="nav-link active" data-section="users"><i class="fas fa-user-plus"></i> Register
                    Users</a>
                <!-- Repeat for other sections, e.g. data-section="students", etc. -->
                <a href="#" class="nav-link active" data-section="students"><i class="fas fa-user-graduate"></i> Manage
                    Students</a>
                <a href="#" class="nav-link active" data-section="subjects"><i class="fas fa-book-open"></i> Assign
                    Subjects</a>
                <a href="#" class="nav-link active" data-section="timetable"><i class="fas fa-calendar-alt"></i> Create
                    Timetable</a>
                <a href="#" class="nav-link active" data-section="leave"><i class="fas fa-plane-departure"></i> Approve
                    Leave Requests</a>
                <a href="#" class="nav-link active" data-section="attendance"><i class="fas fa-chart-bar"></i>
                    Attendance Summary</a>
                <a href="#" class="nav-link active" data-section="announcements"><i class="fas fa-bullhorn"></i> Manage
                    Announcements</a>
                <a href="#" class="nav-link active" data-section="reports"><i class="fas fa-chart-line"></i> View
                    Reports</a>
                <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Log Out</a>
            </div>
            <!-- Main Content -->
            <div class="col-md-9 content">
                <div id="adminContent">
                    <div class="card">
                        <div class="card-header">
                            Welcome, <span th:text="${#authentication?.name ?: 'Admin'}">Admin</span>
                        </div>
                        <div class="card-body">
                            <p>Select a task from the menu on the left to get started.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- createmodal -->
        <div class="modal fade" id="createUsersModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <form id="userForm" class="modal-content">
                    <div class="modal-body">
                        <input type="hidden" id="userId" name="userId">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="fullName" name="fullName" required>
                            <div class="error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                            <div class="error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                            <div class="error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="roles" class="form-label">Roles</label>
                            <select class="form-select selectpicker" id="roles" name="roles" multiple required>
                                <option value="ADMIN">Admin</option>
                                <option value="TEACHER">Teacher</option>
                                <option value="STUDENT">Student</option>
                            </select>
                            <div class="error"></div>
                        </div>

                        <div class="mb-3">
                            <label for="fromDate" class="form-label">Join Date</label>
                            <input type="text" class="form-control" id="fromDate" name="fromDate" />
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-success" id="btnsave">Save</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                id="btncancel">Cancel</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Only keep modals here if you want them available on every page -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.7.9/dist/js/tempus-dominus.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> -->

    

    <script th:inline="javascript">
        var context = "";
        var roles = "";
        console.log(roles);
    </script>
    <script src="/js/admin/users.js"></script>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            flatpickr("#fromDate", {
                dateFormat: "Y-m-d",
            });
        });
       

        $(document).ready(function () {
            $('#usersTable').DataTable();
            // $('#assignTable').DataTable();
            // $('#timetableTable').DataTable();
        });

        document.querySelectorAll('.sidebar a[data-section]').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const section = this.getAttribute('data-section');

                fetch(`/admin/fragment/${section}`)
                    .then(res => res.text())
                    .then(html => {
                        document.getElementById('adminContent').innerHTML = html;

                        // Initialize DataTables
                        const usersTable = document.querySelector('#usersTable');
                        if (usersTable) {
                            if ($.fn.DataTable.isDataTable(usersTable)) {
                                $(usersTable).DataTable().destroy();
                            }
                            $(usersTable).DataTable({
                                responsive: true,
                                autoWidth: false,
                            });
                        }

                        // The modal is outside #adminContent, so always present
                        const btnAddUsers = document.getElementById('btnAddUsers');
                        const createUsersModal = document.getElementById('createUsersModal');

                        if (btnAddUsers && createUsersModal) {
                            const userModal = new bootstrap.Modal(createUsersModal, {
                                backdrop: 'static',
                                keyboard: false,
                            });

                            // Clean old listeners and add new one
                            btnAddUsers.replaceWith(btnAddUsers.cloneNode(true));
                            const newBtnAddUsers = document.getElementById('btnAddUsers');
                            newBtnAddUsers.addEventListener('click', () => userModal.show());
                        } else {
                            console.warn('Modal or button not found in this section');
                        }
                    })
                    .catch(err => console.error('Failed to load section:', err));
            });
        });

        // tooltips
        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });

    </script>



</body>

</html>