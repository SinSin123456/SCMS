<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Assign Subjects</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #e9ecef;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, .05);
        }

        .card-header {
            background-color: #007bff;
            color: white;
            border-bottom: none;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
        }

        .card-header h3 {
            margin-bottom: 0;
            color: white;
        }

        .modal-header {
            background-color: #007bff;
            color: white;
            border-bottom: none;
            border-top-left-radius: calc(.5rem - 1px);
            border-top-right-radius: calc(.5rem - 1px);
        }

        .modal-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }

        .input-control label {
            font-weight: 500;
            margin-bottom: .25rem;
        }

        .input-control .error {
            font-size: 0.875em;
            color: #dc3545;
            margin-top: .25rem;
        }

        .input-control input.is-invalid,
        .input-control select.is-invalid {
            border-color: #dc3545;
        }

        .input-control input.is-valid,
        .input-control select.is-valid {
            border-color: #28a745;
        }

        .table thead th {
            background-color: #007bff;
            color: white;
            vertical-align: middle;
        }

        .table tbody tr:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0"><i class="fas fa-book-open me-2"></i>Assign Subjects</h3>
                <button type="button" class="btn btn-success" onclick="showAssignModal()">
                    <i class="fas fa-plus"></i> Assign Subject
                </button>
            </div>
            <div class="card-body">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="subjectSearch"
                        placeholder="Search by person or subject">
                    <button class="btn btn-primary" type="button" id="searchSubjectBtn"><i class="fas fa-search"></i>
                        Search</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover table-bordered align-middle" id="subjectsTable">
                        <thead>
                            <tr>
                                <th class="text-center">No</th>
                                <th class="text-center">ID</th>
                                <th class="text-center">Person</th>
                                <th class="text-center">Role</th>
                                <th class="text-center">Subject</th>
                                <th class="text-center">Term</th>
                                <th class="text-center">Edit</th>
                                <th class="text-center">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Assignment rows will be loaded here by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Assign Subject Modal -->
    <div class="modal fade" id="assignModal" tabindex="-1" aria-labelledby="assignModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form id="assignForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="assignModalLabel"><i class="fas fa-plus"></i> Assign Subject</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="assignmentId" name="assignmentId">
                    <div class="mb-3 input-control">
                        <label for="personName" class="form-label">Person</label>
                        <input type="text" class="form-control" id="personName" name="personName" required
                            placeholder="Student or Teacher Name">
                        <div class="error"></div>
                    </div>
                    <div class="mb-3 input-control">
                        <label for="role" class="form-label">Role</label>
                        <select class="form-select" id="role" name="role" required>
                            <option value="">Select Role</option>
                            <option value="STUDENT">Student</option>
                            <option value="TEACHER">Teacher</option>
                        </select>
                        <div class="error"></div>
                    </div>
                    <div class="mb-3 input-control">
                        <label for="subject" class="form-label">Subject</label>
                        <select class="form-select" id="subject" name="subject" required>
                            <option value="">Select Subject</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="English Literature">English Literature</option>
                            <option value="Physics">Physics</option>
                            <option value="Chemistry">Chemistry</option>
                            <!-- Add more subjects as needed -->
                        </select>
                        <div class="error"></div>
                    </div>
                    <div class="mb-3 input-control">
                        <label for="term" class="form-label">Term</label>
                        <input type="text" class="form-control" id="term" name="term" required
                            placeholder="e.g., 2025 Term 1">
                        <div class="error"></div>
                    </div>
                    <div id="assignFormMsg" class="text-danger"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let editingAssignmentId = null;
        const assignModal = new bootstrap.Modal(document.getElementById('assignModal'));
        const assignForm = document.getElementById('assignForm');
        const assignFormMsg = document.getElementById('assignFormMsg');

        // Dummy data for UI demo
        let assignments = [
            { id: 1, personName: "Mr. Chan", role: "TEACHER", subject: "Mathematics", term: "2025 Term 1" },
            { id: 2, personName: "Sok Dara", role: "STUDENT", subject: "Physics", term: "2025 Term 2" }
        ];

        // Show modal for new assignment
        function showAssignModal() {
            editingAssignmentId = null;
            assignForm.reset();
            clearValidation();
            assignFormMsg.textContent = '';
            document.getElementById('assignModalLabel').textContent = 'Assign Subject';
            assignModal.show();
        }

        // Load assignments (dummy data for UI demo)
        function loadAssignments(search = '') {
            const tbody = document.querySelector('#subjectsTable tbody');
            let filtered = assignments;
            if (search) {
                const s = search.toLowerCase();
                filtered = assignments.filter(a =>
                    a.personName.toLowerCase().includes(s) ||
                    a.subject.toLowerCase().includes(s) ||
                    a.term.toLowerCase().includes(s)
                );
            }
            tbody.innerHTML = filtered.map((a, idx) => `
        <tr>
            <td class="text-center">${idx + 1}</td>
            <td class="text-center">${a.id}</td>
            <td>${a.personName}</td>
            <td>${a.role}</td>
            <td>${a.subject}</td>
            <td>${a.term}</td>
            <td class="text-center">
                <button class="btn btn-sm btn-primary" onclick="editAssignment(${a.id})"><i class="fas fa-edit"></i> Edit</button>
            </td>
            <td class="text-center">
                <button class="btn btn-sm btn-danger" onclick="deleteAssignment(${a.id})"><i class="fas fa-trash-alt"></i> Delete</button>
            </td>
        </tr>
    `).join('') || `
        <tr>
            <td colspan="8" class="text-center text-muted">No assignments found.</td>
        </tr>
    `;
        }
        loadAssignments();

        // Search functionality
        document.getElementById('searchSubjectBtn').onclick = function () {
            loadAssignments(document.getElementById('subjectSearch').value);
        };

        // Edit assignment (dummy for UI demo)
        function editAssignment(id) {
            const assignment = assignments.find(a => a.id === id);
            if (!assignment) return;
            editingAssignmentId = id;
            assignForm.personName.value = assignment.personName;
            assignForm.role.value = assignment.role;
            assignForm.subject.value = assignment.subject;
            assignForm.term.value = assignment.term;
            clearValidation();
            assignFormMsg.textContent = '';
            document.getElementById('assignModalLabel').textContent = 'Edit Assignment';
            assignModal.show();
        }

        // Delete assignment (dummy for UI demo)
        function deleteAssignment(id) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                assignments = assignments.filter(a => a.id !== id);
                loadAssignments();
            }
        }

        // Form validation and submit
        assignForm.onsubmit = function (e) {
            e.preventDefault();
            assignFormMsg.textContent = '';
            if (!validateForm()) return;
            const assignment = {
                id: editingAssignmentId || (assignments.length ? Math.max(...assignments.map(a => a.id)) + 1 : 1),
                personName: assignForm.personName.value,
                role: assignForm.role.value,
                subject: assignForm.subject.value,
                term: assignForm.term.value
            };
            if (editingAssignmentId) {
                assignments = assignments.map(a => a.id === editingAssignmentId ? assignment : a);
            } else {
                assignments.push(assignment);
            }
            assignModal.hide();
            loadAssignments();
        };

        function validateForm() {
            let valid = true;
            clearValidation();

            if (!assignForm.personName.value.trim()) {
                setError(assignForm.personName, "Person name is required.");
                valid = false;
            } else {
                setSuccess(assignForm.personName);
            }

            if (!assignForm.role.value) {
                setError(assignForm.role, "Role is required.");
                valid = false;
            } else {
                setSuccess(assignForm.role);
            }

            if (!assignForm.subject.value) {
                setError(assignForm.subject, "Subject is required.");
                valid = false;
            } else {
                setSuccess(assignForm.subject);
            }

            if (!assignForm.term.value.trim()) {
                setError(assignForm.term, "Term is required.");
                valid = false;
            } else {
                setSuccess(assignForm.term);
            }

            return valid;
        }

        function setError(element, message) {
            const inputControl = element.parentElement;
            const errorDisplay = inputControl.querySelector('.error');
            errorDisplay.innerText = message;
            element.classList.add('is-invalid');
            element.classList.remove('is-valid');
        }

        function setSuccess(element) {
            const inputControl = element.parentElement;
            const errorDisplay = inputControl.querySelector('.error');
            errorDisplay.innerText = '';
            element.classList.remove('is-invalid');
            element.classList.add('is-valid');
        }

        function clearValidation() {
            assignForm.querySelectorAll('.form-control, .form-select').forEach(el => {
                el.classList.remove('is-invalid', 'is-valid');
                const errorDisplay = el.parentElement.querySelector('.error');
                if (errorDisplay) errorDisplay.innerText = '';
            });
        }
    </script>
</body>

</html>